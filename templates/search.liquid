{%- liquid
  assign search_terms = search.terms | escape
  assign search_results = search.results
  assign search_types = search.types
  assign products = search_results | where: 'object_type', 'product'
  assign articles = search_results | where: 'object_type', 'article'
  assign pages = search_results | where: 'object_type', 'page'
-%}

<div class="search" data-section-id="{{ section.id }}" data-section-type="search">
  <div class="search__header">
    <h1 class="search__title">
      {{ 'general.search.title' | t }}
    </h1>
    
    <div class="search__form">
      <form action="{{ routes.search_url }}" method="get" role="search" class="search__form-inner">
        <input
          type="search"
          name="q"
          value="{{ search_terms }}"
          placeholder="{{ 'general.search.placeholder' | t }}"
          class="search__input"
          aria-label="{{ 'general.search.placeholder' | t }}"
        >
        <input type="hidden" name="type" value="product,article,page">
        <button type="submit" class="search__submit button">
          {{ 'general.search.submit' | t }}
        </button>
      </form>
    </div>
  </div>

  {%- if search_terms != blank -%}
    <div class="search__results">
      {%- if search_results.size > 0 -%}
        <div class="search__results-count">
          {{ 'general.search.results_with_count' | t: terms: search_terms, count: search_results.size }}
        </div>

        {%- if products.size > 0 -%}
          <div class="search__products">
            <h2 class="search__products-title">
              {{ 'general.search.products' | t }}
            </h2>
            
            <div class="search__products-grid">
              {%- for product in products -%}
                <div class="search__product">
                  <div class="search__product-card">
                    <a href="{{ product.url }}" class="search__product-link">
                      <div class="search__product-image-wrapper">
                        {%- if product.featured_image != blank -%}
                          <img
                            src="{{ product.featured_image | img_url: '300x' }}"
                            alt="{{ product.featured_image.alt | escape }}"
                            class="search__product-image"
                            loading="lazy"
                            width="{{ product.featured_image.width }}"
                            height="{{ product.featured_image.height }}"
                          >
                        {%- else -%}
                          {{ 'product-1' | placeholder_svg_tag: 'search__product-image search__product-image--placeholder' }}
                        {%- endif -%}
                      </div>
                      
                      <div class="search__product-content">
                        <h3 class="search__product-title">{{ product.title }}</h3>
                        
                        <div class="search__product-price">
                          {%- if product.compare_at_price > product.price -%}
                            <span class="search__product-price--sale">
                              {{ product.price | money }}
                            </span>
                            <span class="search__product-price--compare">
                              {{ product.compare_at_price | money }}
                            </span>
                          {%- else -%}
                            {{ product.price | money }}
                          {%- endif -%}
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              {%- endfor -%}
            </div>
          </div>
        {%- endif -%}

        {%- if articles.size > 0 -%}
          <div class="search__articles">
            <h2 class="search__articles-title">
              {{ 'general.search.articles' | t }}
            </h2>
            
            <div class="search__articles-grid">
              {%- for article in articles -%}
                <div class="search__article">
                  <div class="search__article-card">
                    <a href="{{ article.url }}" class="search__article-link">
                      <div class="search__article-image-wrapper">
                        {%- if article.image != blank -%}
                          <img
                            src="{{ article.image | img_url: '300x' }}"
                            alt="{{ article.image.alt | escape }}"
                            class="search__article-image"
                            loading="lazy"
                            width="{{ article.image.width }}"
                            height="{{ article.image.height }}"
                          >
                        {%- else -%}
                          {{ 'article-1' | placeholder_svg_tag: 'search__article-image search__article-image--placeholder' }}
                        {%- endif -%}
                      </div>
                      
                      <div class="search__article-content">
                        <h3 class="search__article-title">{{ article.title }}</h3>
                        
                        <div class="search__article-excerpt">
                          {{ article.excerpt_or_content | strip_html | truncatewords: 30 }}
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              {%- endfor -%}
            </div>
          </div>
        {%- endif -%}

        {%- if pages.size > 0 -%}
          <div class="search__pages">
            <h2 class="search__pages-title">
              {{ 'general.search.pages' | t }}
            </h2>
            
            <div class="search__pages-list">
              {%- for page in pages -%}
                <div class="search__page">
                  <a href="{{ page.url }}" class="search__page-link">
                    {{ page.title }}
                  </a>
                </div>
              {%- endfor -%}
            </div>
          </div>
        {%- endif -%}
      {%- else -%}
        <div class="search__no-results">
          <p>{{ 'general.search.no_results_html' | t: terms: search_terms }}</p>
        </div>
      {%- endif -%}
    </div>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Search",
  "settings": []
}
{% endschema %} 