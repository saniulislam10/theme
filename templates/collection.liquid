{%- liquid
  assign sort_by = collection.sort_by | default: collection.default_sort_by
  assign products = collection.products
  assign products_per_page = section.settings.products_per_page
  assign columns = section.settings.columns
  assign show_filters = section.settings.show_filters
  assign show_sort = section.settings.show_sort
-%}

<div class="collection" data-section-id="{{ section.id }}" data-section-type="collection">
  <div class="collection__header">
    <h1 class="collection__title">{{ collection.title }}</h1>
    
    {%- if collection.description != blank -%}
      <div class="collection__description">
        {{ collection.description }}
      </div>
    {%- endif -%}
  </div>

  <div class="collection__filters">
    {%- if show_filters -%}
      <div class="collection__filter">
        <button type="button" class="collection__filter-button" aria-expanded="false">
          {{ 'collections.filters.title' | t }}
        </button>
        <div class="collection__filter-content">
          {%- for filter in collection.filters -%}
            <div class="collection__filter-group">
              <h3 class="collection__filter-group-title">{{ filter.label }}</h3>
              
              {%- case filter.type -%}
                {%- when 'list' -%}
                  <ul class="collection__filter-list">
                    {%- for filter_value in filter.values -%}
                      <li class="collection__filter-item">
                        <label class="collection__filter-checkbox">
                          <input
                            type="checkbox"
                            name="{{ filter_value.param_name }}"
                            value="{{ filter_value.value }}"
                            {% if filter_value.active %}checked{% endif %}
                            {% if filter_value.count == 0 and filter_value.active == false %}disabled{% endif %}
                          >
                          <span class="collection__filter-checkbox-label">
                            {{ filter_value.label }}
                            <span class="collection__filter-count">({{ filter_value.count }})</span>
                          </span>
                        </label>
                      </li>
                    {%- endfor -%}
                  </ul>
                {%- when 'price_range' -%}
                  <div class="collection__filter-price">
                    <div class="collection__filter-price-fields">
                      <div class="collection__filter-price-field">
                        <label for="Filter-{{ filter.label | escape }}-GTE" class="collection__filter-price-label">
                          {{ 'collections.filters.from' | t }}
                        </label>
                        <input
                          type="number"
                          name="{{ filter.min_value.param_name }}"
                          id="Filter-{{ filter.label | escape }}-GTE"
                          value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
                          placeholder="0"
                          min="0"
                          class="collection__filter-price-input"
                        >
                      </div>
                      <div class="collection__filter-price-field">
                        <label for="Filter-{{ filter.label | escape }}-LTE" class="collection__filter-price-label">
                          {{ 'collections.filters.to' | t }}
                        </label>
                        <input
                          type="number"
                          name="{{ filter.max_value.param_name }}"
                          id="Filter-{{ filter.label | escape }}-LTE"
                          value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                          placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                          min="0"
                          max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                          class="collection__filter-price-input"
                        >
                      </div>
                    </div>
                  </div>
              {%- endcase -%}
            </div>
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}

    {%- if show_sort -%}
      <div class="collection__sort">
        <label for="SortBy" class="collection__sort-label">
          {{ 'collections.sorting.title' | t }}
        </label>
        <select
          name="sort_by"
          id="SortBy"
          class="collection__sort-select"
        >
          {%- for option in collection.sort_options -%}
            <option
              value="{{ option.value }}"
              {% if option.value == sort_by %}selected{% endif %}
            >
              {{ option.name }}
            </option>
          {%- endfor -%}
        </select>
      </div>
    {%- endif -%}
  </div>

  <div class="collection__products">
    <div class="collection__grid collection__grid--{{ columns }}">
      {%- for product in products limit: products_per_page -%}
        <div class="collection__product">
          <div class="collection__product-card">
            <a href="{{ product.url }}" class="collection__product-link">
              <div class="collection__product-image-wrapper">
                {%- if product.featured_image != blank -%}
                  <img
                    src="{{ product.featured_image | img_url: '600x' }}"
                    alt="{{ product.featured_image.alt | escape }}"
                    class="collection__product-image"
                    loading="lazy"
                    width="{{ product.featured_image.width }}"
                    height="{{ product.featured_image.height }}"
                  >
                {%- else -%}
                  {{ 'product-1' | placeholder_svg_tag: 'collection__product-image collection__product-image--placeholder' }}
                {%- endif -%}
              </div>
              
              <div class="collection__product-content">
                <h3 class="collection__product-title">{{ product.title }}</h3>
                
                <div class="collection__product-price">
                  {%- if product.compare_at_price > product.price -%}
                    <span class="collection__product-price--sale">
                      {{ product.price | money }}
                    </span>
                    <span class="collection__product-price--compare">
                      {{ product.compare_at_price | money }}
                    </span>
                  {%- else -%}
                    {{ product.price | money }}
                  {%- endif -%}
                </div>
              </div>
            </a>
            
            <div class="collection__product-actions">
              <form method="post" action="/cart/add" class="collection__product-form">
                <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                <button type="submit" class="collection__product-add-to-cart button">
                  {{ 'products.product.add_to_cart' | t }}
                </button>
              </form>
            </div>
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>

  {%- if paginate.pages > 1 -%}
    <div class="collection__pagination">
      {%- render 'pagination', paginate: paginate -%}
    </div>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Collection",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 24,
      "step": 4,
      "label": "Products per page",
      "default": 16
    },
    {
      "type": "range",
      "id": "columns",
      "min": 2,
      "max": 4,
      "step": 1,
      "label": "Columns",
      "default": 4
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "Show filters",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sort",
      "label": "Show sort options",
      "default": true
    }
  ]
}
{% endschema %} 